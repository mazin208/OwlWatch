#!/usr/bin/env python3
# tracker.py
import os
import sys
from urllib.parse import unquote
from pathlib import Path

# نتأكد أن gui.py في نفس المجلد
SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, SCRIPT_DIR)

try:
    from gui import VideoTrackerApp
except ImportError:
    print("Error: gui.py not found in the same directory!")
    sys.exit(1)

def get_folder_from_caja():
    """يقرأ مسار الفولدر من Caja عبر متغير البيئة"""
    uri = os.environ.get('CAJA_SCRIPT_CURRENT_URI', '')
    if uri.startswith('file://'):
        path = unquote(uri[7:])  # إزالة 'file://'
        return path
    # احتياطي: المجلد الحالي
    return os.getcwd()

if __name__ == "__main__":
    folder = get_folder_from_caja()
    # تأكد أن المسار موجود وفولدر
    if not os.path.isdir(folder):
        print(f"Invalid folder: {folder}")
        sys.exit(1)
    app = VideoTrackerApp(folder)
    app.run()
